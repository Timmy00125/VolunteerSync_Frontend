<div class="organizer-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">Organizer Dashboard</h1>
      <p class="dashboard-subtitle">Manage your events and track performance</p>
    </div>

    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="onCreateEvent()" class="create-button">
        <mat-icon>add</mat-icon>
        Create Event
      </button>

      <button mat-icon-button [matMenuTriggerFor]="dashboardMenu" matTooltip="More options">
        <mat-icon>more_vert</mat-icon>
      </button>

      <mat-menu #dashboardMenu="matMenu">
        <button mat-menu-item (click)="onRefreshData()">
          <mat-icon>refresh</mat-icon>
          Refresh Data
        </button>
        <button mat-menu-item (click)="onExportData()">
          <mat-icon>download</mat-icon>
          Export Data
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <p class="loading-text">Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading()" class="dashboard-content">
    <!-- Overview Cards -->
    <div class="overview-section">
      <h2 class="section-title">Overview</h2>

      <div class="stats-grid">
        <mat-card class="stat-card primary-card">
          <mat-card-content>
            <div class="stat-header">
              <mat-icon class="stat-icon">event</mat-icon>
              <span class="stat-label">Total Events</span>
            </div>
            <div class="stat-value">{{ dashboardStats().totalEvents }}</div>
            <div class="stat-detail">{{ dashboardStats().activeEvents }} active</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card success-card">
          <mat-card-content>
            <div class="stat-header">
              <mat-icon class="stat-icon">people</mat-icon>
              <span class="stat-label">Total Registrations</span>
            </div>
            <div class="stat-value">{{ dashboardStats().totalRegistrations }}</div>
            <div class="stat-detail">Across all events</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card accent-card">
          <mat-card-content>
            <div class="stat-header">
              <mat-icon class="stat-icon">analytics</mat-icon>
              <span class="stat-label">Avg. Capacity</span>
            </div>
            <div class="stat-value">
              {{ dashboardStats().averageCapacityUtilization | number : '1.0-0' }}%
            </div>
            <div class="stat-detail">Utilization rate</div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card warn-card" *ngIf="dashboardStats().eventsNeedingAttention > 0">
          <mat-card-content>
            <div class="stat-header">
              <mat-icon class="stat-icon">warning</mat-icon>
              <span class="stat-label">Need Attention</span>
            </div>
            <div class="stat-value">{{ dashboardStats().eventsNeedingAttention }}</div>
            <div class="stat-detail">Events requiring action</div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Event Management Tabs -->
    <div class="events-section">
      <mat-tab-group
        (selectedTabChange)="onTabChanged($event.index)"
        [selectedIndex]="selectedTabIndex()"
        class="events-tabs"
      >
        <!-- Recent Events Tab -->
        <mat-tab label="Recent Events">
          <div class="tab-content">
            <div class="tab-header">
              <h3 class="tab-title">Recently Created Events</h3>
              <span class="tab-count">{{ recentEvents().length }} events</span>
            </div>

            <div class="events-list" *ngIf="recentEvents().length > 0; else noRecentEvents">
              <mat-card
                *ngFor="let event of recentEvents()"
                class="event-card"
                [class.needs-attention]="event.needsAttention"
              >
                <mat-card-content class="event-content">
                  <div class="event-info">
                    <h4 class="event-title">{{ event.title }}</h4>
                    <p class="event-date">{{ formatDate(event.startTime) }}</p>
                    <p class="event-location">{{ event.location.name }}</p>

                    <div class="event-status">
                      <mat-chip [color]="getStatusColor(event.status)">
                        {{ getStatusText(event.status) }}
                      </mat-chip>

                      <mat-chip *ngIf="event.needsAttention" color="warn" class="attention-chip">
                        <mat-icon>warning</mat-icon>
                        {{ event.attentionReason }}
                      </mat-chip>
                    </div>
                  </div>

                  <div class="event-metrics">
                    <app-capacity-indicator
                      [event]="event"
                      [config]="{ compact: true, showPercentage: true }"
                      [enableRealtime]="true"
                    >
                    </app-capacity-indicator>
                  </div>

                  <div class="event-actions">
                    <button mat-button (click)="onViewEvent(event)">
                      <mat-icon>visibility</mat-icon>
                      View
                    </button>
                    <button mat-button (click)="onEditEvent(event)">
                      <mat-icon>edit</mat-icon>
                      Edit
                    </button>
                    <button mat-button (click)="onManageEvent(event)" color="primary">
                      <mat-icon>settings</mat-icon>
                      Manage
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>

            <ng-template #noRecentEvents>
              <div class="empty-state">
                <mat-icon class="empty-icon">event_note</mat-icon>
                <h3>No Recent Events</h3>
                <p>You haven't created any events recently.</p>
                <button mat-raised-button color="primary" (click)="onCreateEvent()">
                  Create Your First Event
                </button>
              </div>
            </ng-template>
          </div>
        </mat-tab>

        <!-- Upcoming Events Tab -->
        <mat-tab label="Upcoming Events">
          <div class="tab-content">
            <div class="tab-header">
              <h3 class="tab-title">Upcoming Events</h3>
              <span class="tab-count">{{ upcomingEvents().length }} events</span>
            </div>

            <div class="events-list" *ngIf="upcomingEvents().length > 0; else noUpcomingEvents">
              <mat-card *ngFor="let event of upcomingEvents()" class="event-card">
                <mat-card-content class="event-content">
                  <div class="event-info">
                    <h4 class="event-title">{{ event.title }}</h4>
                    <p class="event-date">{{ formatDate(event.startTime) }}</p>
                    <p class="event-location">{{ event.location.name }}</p>
                  </div>

                  <div class="event-metrics">
                    <app-capacity-indicator
                      [event]="event"
                      [config]="{ compact: true, showPercentage: true }"
                      [enableRealtime]="true"
                    >
                    </app-capacity-indicator>
                  </div>

                  <div class="event-actions">
                    <button mat-button (click)="onViewEvent(event)">
                      <mat-icon>visibility</mat-icon>
                      View
                    </button>
                    <button mat-button (click)="onManageEvent(event)" color="primary">
                      <mat-icon>settings</mat-icon>
                      Manage
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>

            <ng-template #noUpcomingEvents>
              <div class="empty-state">
                <mat-icon class="empty-icon">schedule</mat-icon>
                <h3>No Upcoming Events</h3>
                <p>You don't have any upcoming events scheduled.</p>
                <button mat-raised-button color="primary" (click)="onCreateEvent()">
                  Schedule New Event
                </button>
              </div>
            </ng-template>
          </div>
        </mat-tab>

        <!-- Events Needing Attention Tab -->
        <mat-tab label="Needs Attention" *ngIf="eventsNeedingAttention().length > 0">
          <div class="tab-content">
            <div class="tab-header">
              <h3 class="tab-title">Events Needing Attention</h3>
              <span class="tab-count attention-count"
                >{{ eventsNeedingAttention().length }} events</span
              >
            </div>

            <div class="events-list">
              <mat-card
                *ngFor="let event of eventsNeedingAttention()"
                class="event-card attention-card"
              >
                <mat-card-content class="event-content">
                  <div class="event-info">
                    <h4 class="event-title">{{ event.title }}</h4>
                    <p class="event-date">{{ formatDate(event.startTime) }}</p>

                    <div class="attention-reason">
                      <mat-icon class="warning-icon">warning</mat-icon>
                      <span>{{ event.attentionReason }}</span>
                    </div>
                  </div>

                  <div class="event-metrics">
                    <app-capacity-indicator
                      [event]="event"
                      [config]="{ compact: true, showPercentage: true }"
                      [enableRealtime]="true"
                    >
                    </app-capacity-indicator>
                  </div>

                  <div class="event-actions">
                    <button mat-raised-button color="warn" (click)="onManageEvent(event)">
                      <mat-icon>settings</mat-icon>
                      Resolve
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </mat-tab>

        <!-- All Events Tab -->
        <mat-tab label="All Events">
          <div class="tab-content">
            <div class="tab-header">
              <h3 class="tab-title">All Your Events</h3>
              <span class="tab-count">{{ organizerEvents().length }} events</span>
            </div>

            <!-- Events Table -->
            <div class="events-table-container" *ngIf="organizerEvents().length > 0">
              <table mat-table [dataSource]="organizerEvents()" class="events-table">
                <!-- Title Column -->
                <ng-container matColumnDef="title">
                  <th mat-header-cell *matHeaderCellDef>Event</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="event-cell">
                      <span class="event-name">{{ event.title }}</span>
                      <span class="event-location-small">{{ event.location.name }}</span>
                    </div>
                  </td>
                </ng-container>

                <!-- Start Time Column -->
                <ng-container matColumnDef="startTime">
                  <th mat-header-cell *matHeaderCellDef>Date & Time</th>
                  <td mat-cell *matCellDef="let event">
                    {{ formatDate(event.startTime) }}
                  </td>
                </ng-container>

                <!-- Capacity Column -->
                <ng-container matColumnDef="capacity">
                  <th mat-header-cell *matHeaderCellDef>Capacity</th>
                  <td mat-cell *matCellDef="let event">
                    <div class="capacity-cell">
                      <span>{{ event.capacity.current }} / {{ event.capacity.maximum }}</span>
                      <mat-progress-bar
                        [value]="(event.capacity.current / event.capacity.maximum) * 100"
                        class="capacity-bar"
                      >
                      </mat-progress-bar>
                    </div>
                  </td>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Status</th>
                  <td mat-cell *matCellDef="let event">
                    <mat-chip [color]="getStatusColor(event.status)">
                      {{ getStatusText(event.status) }}
                    </mat-chip>
                  </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let event">
                    <button mat-icon-button [matMenuTriggerFor]="eventMenu">
                      <mat-icon>more_vert</mat-icon>
                    </button>

                    <mat-menu #eventMenu="matMenu">
                      <button mat-menu-item (click)="onViewEvent(event)">
                        <mat-icon>visibility</mat-icon>
                        View Event
                      </button>
                      <button mat-menu-item (click)="onEditEvent(event)">
                        <mat-icon>edit</mat-icon>
                        Edit Event
                      </button>
                      <button mat-menu-item (click)="onManageEvent(event)">
                        <mat-icon>settings</mat-icon>
                        Manage
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="eventTableColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: eventTableColumns"></tr>
              </table>
            </div>

            <!-- Empty State for All Events -->
            <div *ngIf="organizerEvents().length === 0" class="empty-state">
              <mat-icon class="empty-icon">event_busy</mat-icon>
              <h3>No Events Found</h3>
              <p>You haven't created any events yet.</p>
              <button mat-raised-button color="primary" (click)="onCreateEvent()">
                Create Your First Event
              </button>
            </div>
          </div>
        </mat-tab>

        <!-- Analytics Tab -->
        <mat-tab label="Analytics">
          <div class="tab-content">
            <div class="tab-header">
              <h3 class="tab-title">Event Analytics</h3>
              <span class="tab-count">{{ organizerEvents().length }} events analyzed</span>
            </div>

            <div
              class="analytics-container"
              *ngIf="organizerEvents().length > 0; else noAnalyticsData"
            >
              <div *ngFor="let event of organizerEvents()" class="event-analytics-section">
                <h4 class="event-analytics-title">{{ event.title }}</h4>
                <app-event-stats
                  [event]="event"
                  [showDetailedStats]="true"
                  [layout]="'grid'"
                  class="event-stats-widget"
                >
                </app-event-stats>
              </div>
            </div>

            <ng-template #noAnalyticsData>
              <div class="empty-state">
                <mat-icon class="empty-icon">analytics</mat-icon>
                <h3>No Analytics Data</h3>
                <p>Create events to see detailed analytics and insights.</p>
                <button mat-raised-button color="primary" (click)="onCreateEvent()">
                  Create Event
                </button>
              </div>
            </ng-template>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
